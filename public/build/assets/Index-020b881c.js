import{r as d,a as t,j as l,F as R,g as k,b as E}from"./app-d026b8e4.js";import{A as C}from"./AuthenticatedLayout-b3e2e481.js";import{P as m}from"./PrimaryButton-9a6cd4f4.js";import{M as v}from"./Modal-8d903de7.js";import"./transition-83397d66.js";function M({roles:o,currentRole:a,showModal:x,setShowModal:r,setRespRole:f}){let c=a.name;const[p,b]=d.useState({}),[y,N]=d.useState({}),[i,h]=d.useState(g());function g(e={}){const n=((s={})=>(a.shareRules.forEach(w=>{s[w.shared_role]=w}),s))();return Object.values(o).forEach(s=>{e={...e,[s.id]:{...s,...n.hasOwnProperty(s.id)?{edit:n[s.id].edit,shareId:n[s.id].id,isShared:!0}:{edit:!1,isShared:!1}}}}),e}d.useEffect(()=>{h(g())},[a]),d.useEffect(()=>{let e=Object.keys(p);e.length>0&&h({...i,[e[0]]:{...i[e[0]],isShared:p[e[0]]}})},[p]),d.useEffect(()=>{let e=Object.keys(y);e.length>0&&h({...i,[e[0]]:{...i[e[0]],edit:y[e[0]]}})},[y]);function u(){r(!1)}function S(){let e=g();if(c.trim().length===0)$.notify("Name can never be empty!");else if(c===a.name&&JSON.stringify(i)===JSON.stringify(e))u(),$.notify("No action to apply!");else{let n=[];for(let s in i)JSON.stringify(i[s])!==JSON.stringify(e[s])&&(i[s].isShared||e[s].isShared)&&n.push(i[s]);if(c===a.name&&Object.keys(n).length===0){u(),$.notify("No action to apply!");return}axios.put("/roles/"+a.id,{name:c,shareRules:JSON.stringify(n)}).then(s=>{s.status===200?(f(s.data),$.notify("Changed successfully","success"),u()):$.notify("An error occurred")}).catch(s=>{$.notify(s.response.data.message??s)})}}return t("div",{children:t(v,{onClose:u,show:x,children:l("div",{className:"px-6 py-6 text-xl",children:[l("div",{className:"mb-4",children:[t("span",{className:"mr-2",children:"Name: "}),t("span",{children:t("input",{defaultValue:c,onInput:e=>{c=e.target.value}})})]}),t("p",{className:"text-xl",children:c+" submits reports to:"}),l("table",{children:[t("thead",{children:l("tr",{children:[t("th",{children:"Role"}),t("th",{children:"Edit"})]})}),t("tbody",{children:Object.values(o).map(e=>i.hasOwnProperty(e.id)?l("tr",{children:[l("td",{children:[t("input",{type:"checkbox",defaultChecked:i[e.id].isShared,onChange:n=>{b({[parseInt(e.id)]:n.target.checked})}})," ",t("span",{className:"ml-2",children:e.name})]}),t("td",{className:"px-5",children:t("input",{type:"checkbox",defaultChecked:i[e.id].edit,onChange:n=>{N({[parseInt(e.id)]:n.target.checked})}})})]},e.id):t(R,{}))})]}),l("div",{children:[t(m,{className:"mr-6",onClick:()=>{S()},children:"Apply"}),t(m,{className:"bg-red-600 hover:bg-red-600",onClick:()=>{u()},children:"Cancel"})]})]})})})}function O({currentRole:o,showModal:a,setShowModal:x}){function r(){x(!1)}function f(){r(),axios.delete("/roles/"+o.id).then(c=>{c.status===200?($.notify("Deleted successfully","success"),k.visit("/roles")):$.notify("An error occurred")}).catch(c=>{$.notify(c.response.data.message??c)})}return t("div",{children:t(v,{onClose:r,show:a,children:l("div",{className:"px-6 py-6 text-xl",children:[l("div",{className:"mb-4 text-xl",children:["Are you sure you want to delete ",t("u",{className:"text-2xl text-green-700 font-bold",children:o.name})," role"]}),l("div",{children:[t(m,{className:"mr-6",onClick:()=>{f()},children:"Apply"}),t(m,{className:"bg-red-600 hover:bg-red-600",onClick:()=>{r()},children:"Cancel"})]})]})})})}function A({fetchedRoles:o}){const[a,x]=d.useState(Object.fromEntries(new Map(o.map(e=>[e.id,e])))),[r,f]=d.useState(!1),[c,p]=d.useState(!1),[b,y]=d.useState(o[0]),[N,i]=d.useState(null),[h,g]=d.useState("");d.useEffect(()=>{N!==null&&x({...a,[N.id]:N})},[N]);function u(e){y(e),f(!0)}function S(e){y(e),p(!0)}return l("div",{children:[l("div",{children:[t("span",{className:"mr-2",children:"New Role"}),t("input",{name:"name",value:h,onInput:e=>g(e.target.value)}),t(m,{className:"ml-2",onClick:()=>{h.trim().length===0?$.notify("Please Enter new role"):axios.post("/roles",{name:h}).then(e=>{e.status===200?(g(""),i(e.data),$.notify("Added successfully","success")):$.notify("An error occurred")}).catch(e=>{$.notify(e.response.data.message??e)})},children:"Save"})]}),t("br",{}),t(M,{roles:a,showModal:r,setShowModal:f,currentRole:b,setRespRole:i}),t(O,{currentRole:b,showModal:c,setShowModal:p}),l("table",{className:"text-xl",children:[t("thead",{children:l("tr",{children:[t("th",{className:"text-left",children:"Role"}),t("th",{className:"text-left",children:"Submits Reports To:"}),t("th",{})]})}),t("tbody",{children:Object.values(a).map(e=>l("tr",{children:[t("td",{className:"pr-4 pb-4 text-left",children:e.name}),t("td",{className:"pr-4 pb-4 text-left",children:e.shareRules.map(n=>l("span",{className:"ml-2 px-2 py-1 rounded-xl border border-gray-400",children:[a[n.shared_role].name,t("span",{className:"pl-2",children:n.edit?"-Editor":"-Viewer"})]},n.id))}),l("td",{className:"pb-4",children:[t(m,{onClick:()=>{u(e)},children:"EDIT"}),t(m,{className:"ml-2 bg-red-600 hover:bg-red-700 focus:bg-red-700 active:bg-red-900",onClick:()=>{S(e)},children:"DELETE"})]})]},e.id))})]})]})}function V({auth:o,roles:a}){return l(C,{user:o.user,children:[t(E,{title:"Roles"}),t("div",{className:"mx-auto p-4 sm:p-6 lg:p-8 bg-white",children:t(A,{fetchedRoles:a})})]})}export{V as default};

import{r as s,a as e,j as n,b as R}from"./app-d026b8e4.js";import{A as k}from"./AuthenticatedLayout-b3e2e481.js";import{P as g}from"./PrimaryButton-9a6cd4f4.js";import{M as E}from"./Modal-8d903de7.js";import"./transition-83397d66.js";function C({currentUser:l,setCurrentUser:r,showModal:p,setShowModal:f,setRespUser:b,roles:v}){let m=null,h=!1;const[c,d]=s.useState({}),[y,N]=s.useState({});s.useEffect(()=>{if(l.hasOwnProperty("id")){f(!0);let t=l.employmentRoles.map(i=>i.id);d({...c,...Object.fromEntries(new Map(v.map(i=>[i.id,t.includes(parseInt(i.id))])))})}else f(!1)},[l]),s.useEffect(()=>{d({...c,...y})},[y]);function u(){r({}),m=null,h=!1}function a(){let t=Object.keys(c).filter(o=>c[o]),i="["+t.toString()+"]";t.length===0?$.notify("A user must have at least one employment role!"):m===null&&!h&&i===l.employmentRoles?$.notify("No action to apply!"):axios.put("/users/"+l.id,{newRole:m,checked:h,employmentRoles:i===l.employmentRoles?null:i}).then(o=>{o.status===200?(b(o.data),$.notify("Changed successfully","success"),u()):$.notify("An error occurred")}).catch(o=>{$.notify(o.response.data.message??o)})}return e("div",{children:e(E,{onClose:u,show:p,children:n("div",{className:"px-6 py-6",children:[n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Name: "}),e("span",{children:l.name})]}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Email: "}),e("span",{children:l.email})]}),e("div",{children:Object.values(v).map(t=>n("span",{children:[e("input",{type:"checkbox",checked:c[t.id],onChange:i=>{N({[parseInt(t.id)]:i.target.checked})}})," ",e("span",{className:"mr-4",children:t.name})]},t.id))}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Type: "}),e("span",{className:"mr-4",children:l.role}),e("label",{className:"mr-4",children:"Change Type:"}),n("select",{defaultValue:l.role,onChange:t=>{m=t.target.value},children:[e("option",{value:"admin",children:"Admin"}),e("option",{value:"normal",children:"Normal"}),e("option",{value:"provisional",children:"Provisional"})]})]}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Status: "}),e("span",{className:"mr-8",children:l.deleted_at!==null?"Deactivated":l.role==="provisional"?"Not Approved":"Active"}),e("input",{type:"checkbox",defaultChecked:!1,onChange:t=>{h=t.target.checked}}),e("label",{className:"ml-3",children:l.deleted_at!==null?"Activate":"Deactivate"})]}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Email Verified: "}),e("span",{children:l.email_verified_at===null?"No":"Yes"})]}),n("div",{children:[e(g,{className:"mr-6",onClick:()=>{a()},children:"Apply"}),e(g,{className:"bg-red-600 hover:bg-red-600",onClick:()=>{u()},children:"Cancel"})]})]})})})}function w({fetchedUsers:l,fetchedRoles:r}){console.log(l);let p=Object.fromEntries(new Map(r.map(a=>[a.id,a])));const[f,b]=s.useState(Object.fromEntries(new Map(l.map(a=>[a.id,a])))),[v,m]=s.useState(!1),[h,c]=s.useState({}),[d,y]=s.useState(null);s.useEffect(()=>{d!==null&&b({...f,[d.id]:d})},[d]);const N="viewUsersTable";$(document).ready(function(){$("#"+N).DataTable({columnDefs:[{searchable:!1,targets:[5]}],bDestroy:!0})});function u(a){c(a)}return n("div",{children:[e(C,{showModal:v,setShowModal:m,currentUser:h,setCurrentUser:c,setRespUser:y,roles:r}),n("table",{id:N,className:"cell-border hover",children:[e("thead",{children:n("tr",{children:[e("th",{children:"Name"}),e("th",{children:"Email"}),e("th",{children:"Roles"}),e("th",{children:"Type"}),e("th",{children:"Status"}),e("th",{children:"Email Verified"}),e("th",{})]})}),e("tbody",{children:Object.values(f).map(a=>n("tr",{children:[e("td",{children:a.name}),e("td",{children:a.email}),e("td",{children:a.employmentRoles.map(t=>p[t.id].name).join(" | ")}),e("td",{children:a.role}),e("td",{children:a.deleted_at!==null?"Deactivated":a.role==="provisional"?"Not Approved":"Active"}),e("td",{children:a.email_verified_at===null?"No":"Yes"}),e("th",{children:e(g,{onClick:()=>{u(a)},children:"EDIT"})})]},a.id))})]})]})}function M({auth:l,users:r,roles:p}){return n(k,{user:l.user,children:[e(R,{title:"Users"}),e("div",{className:"mx-auto p-4 sm:p-6 lg:p-8 bg-white",children:e(w,{fetchedUsers:r,fetchedRoles:p})})]})}export{M as default};

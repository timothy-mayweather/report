import{r as i,a as e,j as n,b as R}from"./app-7a1fd182.js";import{A as k}from"./AuthenticatedLayout-5bd2a27d.js";import{P as g}from"./PrimaryButton-f3267b6c.js";import{M as E}from"./Modal-ff22d37e.js";import"./transition-fd429c95.js";function C({currentUser:a,setCurrentUser:r,showModal:p,setShowModal:f,setRespUser:b,roles:v}){let m=null,h=!1;const[s,d]=i.useState({}),[N,y]=i.useState({});i.useEffect(()=>{if(a.hasOwnProperty("id")){f(!0);let t=JSON.parse(a.employmentRoles);d({...s,...Object.fromEntries(new Map(v.map(c=>[c.id,t.includes(parseInt(c.id))])))})}else f(!1)},[a]),i.useEffect(()=>{d({...s,...N})},[N]);function u(){r({}),m=null,h=!1}function l(){let t=Object.keys(s).filter(o=>s[o]),c="["+t.toString()+"]";t.length===0?$.notify("A user must have at least one employment role!"):m===null&&!h&&c===a.employmentRoles?$.notify("No action to apply!"):axios.put("/users/"+a.id,{newRole:m,checked:h,employmentRoles:c===a.employmentRoles?null:c}).then(o=>{o.status===200?(b(o.data),$.notify("Changed successfully","success"),u()):$.notify("An error occurred")}).catch(o=>{$.notify(o.response.data.message??o)})}return e("div",{children:e(E,{onClose:u,show:p,children:n("div",{className:"px-6 py-6",children:[n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Name: "}),e("span",{children:a.name})]}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Email: "}),e("span",{children:a.email})]}),e("div",{children:Object.values(v).map(t=>n("span",{children:[e("input",{type:"checkbox",checked:s[t.id],onChange:c=>{y({[parseInt(t.id)]:c.target.checked})}})," ",e("span",{className:"mr-4",children:t.name})]},t.id))}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Type: "}),e("span",{className:"mr-4",children:a.role}),e("label",{className:"mr-4",children:"Change Type:"}),n("select",{defaultValue:a.role,onChange:t=>{m=t.target.value},children:[e("option",{value:"admin",children:"Admin"}),e("option",{value:"normal",children:"Normal"}),e("option",{value:"provisional",children:"Provisional"})]})]}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Status: "}),e("span",{className:"mr-8",children:a.deleted_at!==null?"Deactivated":a.role==="provisional"?"Not Approved":"Active"}),e("input",{type:"checkbox",defaultChecked:!1,onChange:t=>{h=t.target.checked}}),e("label",{className:"ml-3",children:a.deleted_at!==null?"Activate":"Deactivate"})]}),n("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Email Verified: "}),e("span",{children:a.email_verified_at===null?"No":"Yes"})]}),n("div",{children:[e(g,{className:"mr-6",onClick:()=>{l()},children:"Apply"}),e(g,{className:"bg-red-600 hover:bg-red-600",onClick:()=>{u()},children:"Cancel"})]})]})})})}function w({fetchedUsers:a,fetchedRoles:r}){let p=Object.fromEntries(new Map(r.map(l=>[l.id,l])));const[f,b]=i.useState(Object.fromEntries(new Map(a.map(l=>[l.id,l])))),[v,m]=i.useState(!1),[h,s]=i.useState({}),[d,N]=i.useState(null);i.useEffect(()=>{d!==null&&b({...f,[d.id]:d})},[d]);const y="viewUsersTable";$(document).ready(function(){$("#"+y).DataTable({columnDefs:[{searchable:!1,targets:[5]}],bDestroy:!0})});function u(l){s(l)}return n("div",{children:[e(C,{showModal:v,setShowModal:m,currentUser:h,setCurrentUser:s,setRespUser:N,roles:r}),n("table",{id:y,className:"cell-border hover",children:[e("thead",{children:n("tr",{children:[e("th",{children:"Name"}),e("th",{children:"Email"}),e("th",{children:"Roles"}),e("th",{children:"Type"}),e("th",{children:"Status"}),e("th",{children:"Email Verified"}),e("th",{})]})}),e("tbody",{children:Object.values(f).map(l=>n("tr",{children:[e("td",{children:l.name}),e("td",{children:l.email}),e("td",{children:JSON.parse(l.employmentRoles).map(t=>p[t].name).join(" | ")}),e("td",{children:l.role}),e("td",{children:l.deleted_at!==null?"Deactivated":l.role==="provisional"?"Not Approved":"Active"}),e("td",{children:l.email_verified_at===null?"No":"Yes"}),e("th",{children:e(g,{onClick:()=>{u(l)},children:"EDIT"})})]},l.id))})]})]})}function D({auth:a,users:r,roles:p}){return n(k,{user:a.user,children:[e(R,{title:"Users"}),e("div",{className:"mx-auto p-4 sm:p-6 lg:p-8 bg-white",children:e(w,{fetchedUsers:r,fetchedRoles:p})})]})}export{D as default};

import{r as s,a as e,j as i,b as R}from"./app-74c4a37c.js";import{A as k}from"./AuthenticatedLayout-ceba2cb9.js";import{P as g}from"./PrimaryButton-612045f9.js";import{M as E}from"./Modal-57d19c88.js";import"./transition-80f8baf5.js";function C({currentUser:a,setCurrentUser:r,showModal:p,setShowModal:f,setRespUser:b,roles:v}){let m=null,h=!1;const[c,d]=s.useState({}),[y,N]=s.useState({});s.useEffect(()=>{if(a.hasOwnProperty("id")){f(!0);let t=a.employmentRoles.map(n=>n.id);d({...c,...Object.fromEntries(new Map(v.map(n=>[n.id,t.includes(parseInt(n.id))])))})}else f(!1)},[a]),s.useEffect(()=>{d({...c,...y})},[y]);function u(){r({}),m=null,h=!1}function l(){let t=Object.keys(c).filter(o=>c[o]),n="["+t.toString()+"]";t.length===0?$.notify("A user must have at least one employment role!"):m===null&&!h&&n===a.employmentRoles?$.notify("No action to apply!"):axios.put("/users/"+a.id,{newRole:m,checked:h,employmentRoles:n===a.employmentRoles?null:n}).then(o=>{o.status===200?(b(o.data),$.notify("Changed successfully","success"),u()):$.notify("An error occurred")}).catch(o=>{$.notify(o.response.data.message??o)})}return e("div",{children:e(E,{onClose:u,show:p,children:i("div",{className:"px-6 py-6",children:[i("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Name: "}),e("span",{children:a.name})]}),i("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Email: "}),e("span",{children:a.email})]}),e("div",{children:Object.values(v).map(t=>i("span",{children:[e("input",{type:"checkbox",checked:c[t.id],onChange:n=>{N({[parseInt(t.id)]:n.target.checked})}})," ",e("span",{className:"mr-4",children:t.name})]},t.id))}),i("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Type: "}),e("span",{className:"mr-4",children:a.role}),e("label",{className:"mr-4",children:"Change Type:"}),i("select",{defaultValue:a.role,onChange:t=>{m=t.target.value},children:[e("option",{value:"admin",children:"Admin"}),e("option",{value:"normal",children:"Normal"}),e("option",{value:"provisional",children:"Provisional"})]})]}),i("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Status: "}),e("span",{className:"mr-8",children:a.deleted_at!==null?"Deactivated":a.role==="provisional"?"Not Approved":"Active"}),e("input",{type:"checkbox",defaultChecked:!1,onChange:t=>{h=t.target.checked}}),e("label",{className:"ml-3",children:a.deleted_at!==null?"Activate":"Deactivate"})]}),i("div",{className:"mb-4",children:[e("span",{className:"mr-2",children:"Email Verified: "}),e("span",{children:a.email_verified_at===null?"No":"Yes"})]}),i("div",{children:[e(g,{className:"mr-6",onClick:()=>{l()},children:"Apply"}),e(g,{className:"bg-red-600 hover:bg-red-600",onClick:()=>{u()},children:"Cancel"})]})]})})})}function w({fetchedUsers:a,fetchedRoles:r}){let p=Object.fromEntries(new Map(r.map(l=>[l.id,l])));const[f,b]=s.useState(Object.fromEntries(new Map(a.map(l=>[l.id,l])))),[v,m]=s.useState(!1),[h,c]=s.useState({}),[d,y]=s.useState(null);s.useEffect(()=>{d!==null&&b({...f,[d.id]:d})},[d]);const N="viewUsersTable";$(document).ready(function(){$("#"+N).DataTable({columnDefs:[{searchable:!1,targets:[5]}],bDestroy:!0})});function u(l){c(l)}return i("div",{children:[e(C,{showModal:v,setShowModal:m,currentUser:h,setCurrentUser:c,setRespUser:y,roles:r}),i("table",{id:N,className:"cell-border hover",children:[e("thead",{children:i("tr",{children:[e("th",{children:"Name"}),e("th",{children:"Email"}),e("th",{children:"Roles"}),e("th",{children:"Type"}),e("th",{children:"Status"}),e("th",{children:"Email Verified"}),e("th",{})]})}),e("tbody",{children:Object.values(f).map(l=>i("tr",{children:[e("td",{children:l.name}),e("td",{children:l.email}),e("td",{children:l.employmentRoles.map(t=>p[t.id].name).join(" | ")}),e("td",{children:l.role}),e("td",{children:l.deleted_at!==null?"Deactivated":l.role==="provisional"?"Not Approved":"Active"}),e("td",{children:l.email_verified_at===null?"No":"Yes"}),e("th",{children:e(g,{onClick:()=>{u(l)},children:"EDIT"})})]},l.id))})]})]})}function M({auth:a,users:r,roles:p}){return i(k,{user:a.user,children:[e(R,{title:"Users"}),e("div",{className:"mx-auto p-4 sm:p-6 lg:p-8 bg-white",children:e(w,{fetchedUsers:r,fetchedRoles:p})})]})}export{M as default};
